<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>FoodWatch</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0f172a" />
  <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32.png" />
  <link rel="apple-touch-icon" href="img/icon-192.png" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div class="app-bg"></div>

  <header class="app-header glass">
    <div class="app-header-main">
      <div>
        <h1>FoodWatch</h1>
        <p class="subtitle">Domowa kontrola zapasów i dat ważności</p>
      </div>
     <div class="header-pill header-pill--online" id="header-status-pill">
  <span class="header-pill-dot"></span>
  <span class="header-pill-text" id="header-status-text">Online</span>
</div>
    </div>

    <nav class="top-nav">
      <button data-view="dashboard" class="nav-btn nav-btn--active">Dashboard</button>
      <button data-view="pantry" class="nav-btn">Spiżarnia</button>
      <button data-view="scanner" class="nav-btn">Dodaj</button>
      <button data-view="shopping" class="nav-btn">Zakupy</button>
      <button data-view="history" class="nav-btn">Historia</button>
      <button data-view="stats" class="nav-btn">Statystyki</button>
      <button data-view="settings" class="nav-btn">Ustawienia</button>
    </nav>
  </header>

  <div id="offline-banner" class="offline-banner" hidden>
    Jesteś offline – dane lokalne są nadal dostępne.
  </div>

  <main class="app-main">
    <!-- Dashboard -->
    <section id="view-dashboard" class="view view--active">
      <div class="view-header">
        <h2>Dashboard</h2>
        <p class="view-subtitle">
          Podgląd najważniejszych informacji o spiżarni i alertach.
        </p>
      </div>

      <div class="card-grid">
        <article class="card card--stat">
          <h3>Produkty w spiżarni</h3>
          <p class="stat-value" id="stat-total">0</p>
          <p class="stat-caption">Aktywnie śledzone pozycje</p>
        </article>

        <article class="card card--stat">
          <h3>Zbliżający się termin</h3>
          <p class="stat-value" id="stat-soon-expiring">0</p>
          <p class="stat-caption">≤ 3 dni do końca (domyślnie)</p>
        </article>

        <article class="card card--stat card--danger">
          <h3>Przeterminowane</h3>
          <p class="stat-value" id="stat-expired">0</p>
          <p class="stat-caption">Wymagają uwagi</p>
        </article>

        <article class="card card--stat card--risk">
          <h3>Wskaźnik ryzyka</h3>
          <p class="stat-risk-text">
            <span id="stat-risk-percentage">0%</span> produktów wymaga uwagi
          </p>
          <div class="progress">
            <div class="progress-bar" id="risk-progress-bar"></div>
          </div>
        </article>
      </div>

      <section class="section">
        <div class="section-header">
          <h3>Ostatnie alerty o ważności</h3>
          <button id="btn-refresh-dashboard" class="btn-secondary">Odśwież</button>
        </div>
        <ul id="alert-history-list" class="list list--compact"></ul>
      </section>

      <section class="section">
        <button id="btn-toggle-info" class="btn-info">
          Jak działa FoodWatch?
        </button>
        <div id="info-panel" class="info-panel" hidden>
          <p>
            FoodWatch to progresywna aplikacja webowa (PWA) do zarządzania
            domową spiżarnią:
          </p>
          <ul>
            <li>Skanuje kody kreskowe produktów kamerą (jeśli urządzenie wspiera).</li>
            <li>Pobiera nazwy z OpenFoodFacts lub pozwala wpisać je ręcznie.</li>
            <li>Śledzi daty ważności, ilość i lokalizację na półkach.</li>
            <li>Działa offline dzięki IndexedDB i Service Workerowi.</li>
            <li>Wysyła natywne powiadomienia o produktach przeterminowanych i kończących się.</li>
            <li>Dodaje zużyte/przeterminowane produkty do listy zakupów.</li>
          </ul>
        </div>
      </section>
    </section>

    <!-- Spiżarnia -->
    <section id="view-pantry" class="view">
      <div class="view-header">
        <h2>Spiżarnia</h2>
        <p class="view-subtitle">
          Wszystkie produkty aktualnie przechowywane w spiżarni.
        </p>
      </div>

      <div class="filters glass">
        <label class="filter-field">
          <span>Lokalizacja</span>
          <input type="text" id="filter-location" placeholder="np. A3, E10..." />
        </label>
        <label class="filter-field">
          <span>Szukaj</span>
          <input type="text" id="filter-search" placeholder="nazwa lub marka" />
        </label>
        <label class="filter-field">
          <span>Sortowanie</span>
          <select id="filter-sort">
            <option value="expiry-asc">Data ważności (rosnąco)</option>
            <option value="name-asc">Nazwa (A–Z)</option>
            <option value="location-asc">Lokalizacja</option>
          </select>
        </label>
        <button id="btn-apply-filter" class="btn-secondary">Zastosuj</button>
      </div>

      <ul id="pantry-list" class="list"></ul>
    </section>

    <!-- Skaner / Dodawanie -->
    <section id="view-scanner" class="view">
      <div class="view-header">
        <h2>Dodaj lub edytuj produkt</h2>
        <p class="view-subtitle">
          Możesz użyć skanera kodów kreskowych lub wyszukiwarki OpenFoodFacts.
        </p>
      </div>

      <p class="hint">
        Jeśli skaner nie jest dostępny (np. Safari na iOS), korzystaj z wyszukiwarki
        po nazwie lub wpisz dane ręcznie.
      </p>
      <p id="edit-hint" class="edit-hint" hidden>
        Tryb edycji: zapis nadpisze istniejący produkt.
      </p>

      <div id="scanner-container" class="glass scanner-shell">
        <video id="video" autoplay playsinline></video>
        <div id="html5qr-reader" style="display: none;"></div>
        <p id="scanner-info">
          Skaner używa kamery tylnej (BarcodeDetector, jeśli dostępny).
          Jeśli przycisk jest wyszarzony, skorzystaj z wyszukiwarki produktów poniżej.
        </p>
        <div class="scanner-actions">
          <button id="btn-start-scan" class="btn-primary">Uruchom skaner</button>
          <button id="btn-stop-scan" class="btn-secondary" disabled>
            Zatrzymaj skaner
          </button>
        </div>
      </div>

      <!-- Wyszukiwarka w OpenFoodFacts po nazwie -->
      <section class="section">
        <div class="search-existing glass">
          <label>
            Wyszukaj produkt w OpenFoodFacts (po nazwie):
            <input
              type="text"
              id="input-search-existing"
              placeholder="np. Mleko Łaciate 3.2%"
            />
          </label>
          <div id="search-existing-status" class="search-status"></div>
          <ul
            id="search-existing-results"
            class="list list--compact search-results"
          ></ul>
        </div>
      </section>

      <form class="form glass" id="product-form" onsubmit="return false;">
        <div class="form-grid">
          <label>
            Kod kreskowy:
            <input type="text" id="input-barcode" placeholder="Lub wpisz ręcznie" />
          </label>
          <div class="form-inline">
            <button id="btn-fetch-product" class="btn-secondary" type="button">
              Pobierz po kodzie z OpenFoodFacts
            </button>
          </div>

          <label>
            Nazwa produktu:
            <input type="text" id="input-name" />
          </label>
          <label>
            Marka:
            <input type="text" id="input-brand" />
          </label>
          <label>
            Data ważności:
            <input type="date" id="input-expiry" />
          </label>
          <label>
            Ilość:
            <input type="number" id="input-quantity" min="1" value="1" />
          </label>
          <label>
            Lokalizacja (np. A3, E3, E10):
            <input type="text" id="input-location" list="location-presets" />
          </label>
        </div>

        <datalist id="location-presets"></datalist>

        <div class="form-actions">
          <button id="btn-save-product" class="btn-primary" type="submit">
            Zapisz produkt
          </button>
        </div>
      </form>
    </section>

    <!-- Zakupy -->
    <section id="view-shopping" class="view">
      <div class="view-header">
        <h2>Lista zakupów</h2>
        <p class="view-subtitle">
          Produkty trafiają tutaj automatycznie (zużyte / przeterminowane)
          lub po kliknięciu „Do zakupów”.
        </p>
      </div>

      <section class="card shopping-summary glass">
        <div class="shopping-summary-main">
          <div>
            <p class="summary-label">Produkty do kupienia</p>
            <p class="summary-value" id="shopping-count-todo">0</p>
          </div>
          <div>
            <p class="summary-label">Szacunkowy koszt koszyka</p>
            <p class="summary-value" id="shopping-estimate">0 zł</p>
          </div>
        </div>
        <p class="summary-caption" id="shopping-estimate-caption">
          Dodaj produkty do listy, aby zobaczyć szacunkowy koszt.
        </p>
        <div id="shopping-ai-breakdown" class="shopping-ai-breakdown"></div>
      </section>

      <div class="shopping-actions">
        <button id="btn-shopping-share" class="btn-secondary">
          Udostępnij listę
        </button>
        <button id="btn-shopping-nearby" class="btn-secondary">
          Sklepy w pobliżu
        </button>
        <button id="btn-shopping-clear-bought" class="btn-secondary">
          Wyczyść „Kupione”
        </button>
      </div>

      <div class="shopping-columns">
        <div class="shopping-column">
          <h3>Do kupienia</h3>
          <ul id="shopping-list-todo" class="list"></ul>
        </div>
        <div class="shopping-column">
          <h3>Kupione (ostatnie 7 dni)</h3>
          <ul id="shopping-list-bought" class="list list--compact"></ul>
        </div>
      </div>
    </section>

    <!-- Historia działań -->
    <section id="view-history" class="view">
      <div class="view-header">
        <h2>Historia działań</h2>
        <p class="view-subtitle">
          Rejestr operacji w FoodWatch (dodawanie, edycja, zużycie, zakupy).
        </p>
      </div>

      <ul id="history-list" class="list list--compact"></ul>

      <section class="section">
        <button id="btn-export-data" class="btn-secondary">
          Eksportuj dane do JSON
        </button>
      </section>
    </section>

    <!-- Statystyki / Zero waste -->
    <section id="view-stats" class="view">
      <div class="view-header">
        <h2>Statystyki i Zero Waste</h2>
        <p class="view-subtitle">
          Podsumowanie zużycia, marnowania i nawyków zakupowych.
        </p>
      </div>

      <div class="card-grid stats-grid">
        <article class="card glass stats-card">
          <h3>Zero Waste Score</h3>
          <div class="zero-score">
            <span id="stat-zero-score-value">0%</span>
            <span id="stat-zero-score-label" class="zero-score-label">
              Brak danych – używaj produktów i oznaczaj je jako kupione
            </span>
          </div>
          <div class="progress progress--lg">
            <div id="zero-score-bar" class="progress-bar"></div>
          </div>
        </article>

        <article class="card glass stats-card">
          <h3>Ten miesiąc</h3>
          <p class="stats-line">
            <span>Dodane produkty</span>
            <strong id="stat-added-month">0</strong>
          </p>
          <p class="stats-line">
            <span>Zużyte</span>
            <strong id="stat-used-month">0</strong>
          </p>
          <p class="stats-line">
            <span>Przeterminowane</span>
            <strong id="stat-expired-month">0</strong>
          </p>
        </article>

        <article class="card glass stats-card">
          <h3>Najczęściej marnowane kategorie</h3>
          <ul id="stat-wasted-categories" class="stats-list"></ul>
        </article>

        <article class="card glass stats-card">
          <h3>Pomysły na wykorzystanie</h3>
          <p class="hint">
            Propozycje na podstawie produktów, którym kończy się ważność.
          </p>
          <ul id="stat-ideas-list" class="stats-list"></ul>
        </article>
      </div>
    </section>

    <!-- Ustawienia -->
    <section id="view-settings" class="view">
      <div class="view-header">
        <h2>Ustawienia</h2>
        <p class="view-subtitle">
          Dostosuj powiadomienia, progi dni, motyw oraz domyślne lokalizacje.
        </p>
      </div>

      <section class="settings-grid">
        <article class="card glass settings-card">
          <h3>Powiadomienia o ważności</h3>
          <div class="form-vertical">
            <label class="switch-line">
              <input type="checkbox" id="settings-notify-expired" />
              <span>Powiadamiaj o produktach przeterminowanych</span>
            </label>
            <label class="switch-line">
              <input type="checkbox" id="settings-notify-soon" />
              <span>Powiadamiaj, gdy termin kończy się wkrótce</span>
            </label>
            <label>
              Próg „wkrótce” (dni):
              <input type="number" id="settings-soon-days" min="1" max="14" />
            </label>
          </div>
        </article>

        <article class="card glass settings-card">
          <h3>Częstotliwość sprawdzania</h3>
          <p class="hint">
            Określa, jak często aplikacja w tle sprawdza daty ważności
            (gdy PWA jest otwarta).
          </p>
          <label>
            Co ile godzin sprawdzać:
            <select id="settings-check-interval">
              <option value="6">Co 6 godzin</option>
              <option value="12">Co 12 godzin</option>
              <option value="24">Raz dziennie</option>
            </select>
          </label>
        </article>

        <article class="card glass settings-card">
          <h3>Motyw aplikacji</h3>
          <p class="hint">
            Motyw zmienia kolory tła, kart i tekstu. Ustaw „Auto”, aby
            dopasować się do motywu systemowego (jeśli wspierane).
          </p>
          <label>
            Motyw:
            <select id="settings-theme">
              <option value="auto">Auto (system)</option>
              <option value="light">Jasny</option>
              <option value="dark">Ciemny</option>
            </select>
          </label>
        </article>

        <article class="card glass settings-card">
          <h3>Domyślne lokalizacje półek</h3>
          <p class="hint">
            Rozdziel średnikiem, np. <code>Lodówka;Półka A1</code>.
            Pojawią się jako podpowiedzi przy dodawaniu produktu.
          </p>
          <label>
            Półki i miejsca:
            <input type="text" id="settings-shelf-presets" />
          </label>
        </article>
      </section>

      <div class="settings-actions">
        <button id="btn-settings-save" class="btn-primary">
          Zapisz ustawienia
        </button>
      </div>
    </section>
  </main>

<script src="js/db.js"></script>
<script src="js/aiPriceAgent.js"></script>
<script src="js/notifications.js"></script>
<script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
<script src="js/scanner.js"></script>
<script src="js/app.js"></script>
</body>
</html>
